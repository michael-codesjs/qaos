generator be_main {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-arm64-openssl-3.0.x", "linux-musl-openssl-3.0.x"]
  output = "../../services/main/src/generated/prisma_client"
}

generator nexus_prisma {
  provider = "nexus-prisma"
  output = "../../services/main/src/generated/nexus-prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  
  id            String    @id @default(uuid())
  name          String
  email         String    @unique
  emailVerified Boolean   @default(false)
  image         String?
  profilePictureKey String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  phoneNumber   String?   @unique
  
  sessions      Session[]
  accounts      Account[]
  projects      Project[]

  @@map("user")

}

model Session {
  id        String   @id @default(uuid())
  userId    String
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  activeOrganizationId String?
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("session")
}

model Account {
  id                    String    @id @default(uuid())
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@map("account")
}

model Verification {
  id         String    @id @default(uuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime? @default(now())
  updatedAt  DateTime? @updatedAt

  @@map("verification")
}

model Project {
  id          String   @id @default(uuid())
  name        String
  url         String?
  description String?
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("project")
}

model mastra_agents {
  id               String    @id
  name             String
  description      String?
  instructions     String
  model            Json
  tools            Json?
  defaultOptions   Json?
  workflows        Json?
  agents           Json?
  inputProcessors  Json?
  outputProcessors Json?
  memory           Json?
  scorers          Json?
  metadata         Json?
  createdAt        DateTime  @db.Timestamp(6)
  updatedAt        DateTime  @db.Timestamp(6)
  createdAtZ       DateTime? @default(now()) @db.Timestamptz(6)
  updatedAtZ       DateTime? @default(now()) @db.Timestamptz(6)
}

model mastra_ai_spans {
  traceId        String
  spanId         String
  name           String
  spanType       String
  isEvent        Boolean
  startedAt      DateTime  @db.Timestamp(6)
  parentSpanId   String?
  entityType     String?
  entityId       String?
  entityName     String?
  userId         String?
  organizationId String?
  resourceId     String?
  runId          String?
  sessionId      String?
  threadId       String?
  requestId      String?
  environment    String?
  source         String?
  serviceName    String?
  scope          Json?
  metadata       Json?
  tags           Json?
  attributes     Json?
  links          Json?
  input          Json?
  output         Json?
  error          Json?
  endedAt        DateTime? @db.Timestamp(6)
  createdAt      DateTime  @db.Timestamp(6)
  updatedAt      DateTime? @db.Timestamp(6)
  startedAtZ     DateTime? @default(now()) @db.Timestamptz(6)
  endedAtZ       DateTime? @default(now()) @db.Timestamptz(6)
  createdAtZ     DateTime? @default(now()) @db.Timestamptz(6)
  updatedAtZ     DateTime? @default(now()) @db.Timestamptz(6)

  @@id([traceId, spanId], map: "public_mastra_ai_spans_traceid_spanid_pk")
  @@index([entityType, entityId], map: "mastra_ai_spans_entitytype_entityid_idx")
  @@index([entityType, entityName], map: "mastra_ai_spans_entitytype_entityname_idx")
  @@index([metadata], map: "mastra_ai_spans_metadata_gin_idx", type: Gin)
  @@index([name])
  @@index([organizationId, userId], map: "mastra_ai_spans_orgid_userid_idx")
  @@index([parentSpanId, startedAt(sort: Desc)], map: "mastra_ai_spans_parentspanid_startedat_idx")
  @@index([spanType, startedAt(sort: Desc)], map: "mastra_ai_spans_spantype_startedat_idx")
  @@index([tags], map: "mastra_ai_spans_tags_gin_idx", type: Gin)
  @@index([traceId, startedAt(sort: Desc)], map: "mastra_ai_spans_traceid_startedat_idx")
}

model mastra_messages {
  id         String    @id
  thread_id  String
  content    String
  role       String
  type       String
  createdAt  DateTime  @db.Timestamp(6)
  resourceId String?
  createdAtZ DateTime? @default(now()) @db.Timestamptz(6)

  @@index([thread_id, createdAt(sort: Desc)], map: "mastra_messages_thread_id_createdat_idx")
}

model mastra_resources {
  id            String    @id
  workingMemory String?
  metadata      Json?
  createdAt     DateTime  @db.Timestamp(6)
  updatedAt     DateTime  @db.Timestamp(6)
  createdAtZ    DateTime? @default(now()) @db.Timestamptz(6)
  updatedAtZ    DateTime? @default(now()) @db.Timestamptz(6)
}

model mastra_scorers {
  id                   String    @id
  scorerId             String
  traceId              String?
  spanId               String?
  runId                String
  scorer               Json
  preprocessStepResult Json?
  extractStepResult    Json?
  analyzeStepResult    Json?
  score                Float
  reason               String?
  metadata             Json?
  preprocessPrompt     String?
  extractPrompt        String?
  generateScorePrompt  String?
  generateReasonPrompt String?
  analyzePrompt        String?
  reasonPrompt         String?
  input                Json
  output               Json
  additionalContext    Json?
  requestContext       Json?
  entityType           String?
  entity               Json?
  entityId             String?
  source               String
  resourceId           String?
  threadId             String?
  createdAt            DateTime  @db.Timestamp(6)
  updatedAt            DateTime  @db.Timestamp(6)
  createdAtZ           DateTime? @default(now()) @db.Timestamptz(6)
  updatedAtZ           DateTime? @default(now()) @db.Timestamptz(6)

  @@index([traceId, spanId, createdAt(sort: Desc)], map: "mastra_scores_trace_id_span_id_created_at_idx")
}

model mastra_threads {
  id         String    @id
  resourceId String
  title      String
  metadata   Json?
  createdAt  DateTime  @db.Timestamp(6)
  updatedAt  DateTime  @db.Timestamp(6)
  createdAtZ DateTime? @default(now()) @db.Timestamptz(6)
  updatedAtZ DateTime? @default(now()) @db.Timestamptz(6)

  @@index([resourceId, createdAt(sort: Desc)], map: "mastra_threads_resourceid_createdat_idx")
}

model mastra_workflow_snapshot {
  workflow_name String
  run_id        String
  resourceId    String?
  snapshot      Json
  createdAt     DateTime  @db.Timestamp(6)
  updatedAt     DateTime  @db.Timestamp(6)
  createdAtZ    DateTime? @default(now()) @db.Timestamptz(6)
  updatedAtZ    DateTime? @default(now()) @db.Timestamptz(6)

  @@unique([workflow_name, run_id], map: "public_mastra_workflow_snapshot_workflow_name_run_id_key")
}